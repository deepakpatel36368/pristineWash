<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<body>
<div class="container mt-5">
    <h1 class="text-center mb-4">Product List</h1>
    <div id="product-container"></div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    $(document).ready(function() {
        var categoryId = [[${categoryId}]]; // Access categoryId from the Thymeleaf model

        // Fetch products under a certain category
        $.ajax({
            url: 'product_by_category/' + categoryId + '/categories', // Corrected endpoint URL
            type: 'GET',
            success: function(products) {
                displayProducts(products);
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
                alert('Failed to fetch products');
            }
        });

        // Function to display products in the container
        function displayProducts(products) {
            var productContainer = $('#product-container');
            products.forEach(function(product) {
                var productHtml = '<div class="product" data-product-id="' + product.id + '">' +
                   '<h3>' + product.id + '</h3>' +
                    '<h3>' + product.name + '</h3>' +
                    '<p>Price: $' + product.price + '</p>' +
                    '<button class="btn btn-primary add-to-cart">Add to Cart</button>' +
                    '</div>';
                productContainer.append(productHtml);
            });
        }

        // Event listener for adding product to cart
        $(document).on('click', '.add-to-cart', function() {
        var productId = $(this).closest('.product').data('product-id');
    
        // Make a POST request to add the product to the cart
        $.ajax({
            url: '/carts/' + productId,
            type: 'POST',
            success: function(response) {
                alert('Product added to cart successfully');
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
                alert('Failed to add product to cart');
            }
        });
        });



    });

</script>

</body>
</html>